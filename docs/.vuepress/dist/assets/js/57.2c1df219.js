(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{483:function(t,s,a){"use strict";a.r(s);var n=a(27),v=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_08-调用栈：为什么javascript代码会出现栈溢出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_08-调用栈：为什么javascript代码会出现栈溢出"}},[t._v("#")]),t._v(" 08.调用栈：为什么JavaScript代码会出现栈溢出")]),t._v(" "),a("p",[t._v("在上篇文章中，我们讲到了，当一段代码被执行时，"),a("code",[t._v("JavaScript")]),t._v("引擎先会对其进行"),a("strong",[t._v("编译")]),t._v("，并创建"),a("strong",[t._v("执行上下文")]),t._v("。但是并没有明确说明到底什么样的代码才算符合规范")]),t._v(" "),a("p",[t._v("那么接下来我们就来明确下，哪些情况下代码才算是“一段”代码，才会在执行之前就进行编译并"),a("strong",[t._v("创建执行上下文")]),t._v("。一般说来，有这么"),a("strong",[t._v("三种情况")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("当"),a("code",[t._v("JavaScript")]),t._v("执行"),a("strong",[t._v("全局代码")]),t._v("的时候，会编译全局代码并创建"),a("strong",[t._v("全局执行上下文")]),t._v("，而且在整个页面的生存周期内，全局执行上下文"),a("strong",[t._v("只有一份")]),t._v("。")]),t._v(" "),a("li",[t._v("当调用一个函数的时候，函数体内的代码会被编译，并创建"),a("strong",[t._v("函数执行上下文")]),t._v("，一般情况下，函数"),a("strong",[t._v("执行结束")]),t._v("之后，创建的"),a("strong",[t._v("函数执行上下文会被销毁")]),t._v("。")]),t._v(" "),a("li",[t._v("当使用"),a("strong",[t._v("eval函数")]),t._v("的时候，eval的代码也会被"),a("strong",[t._v("编译")]),t._v("，并创建"),a("strong",[t._v("执行上下文")]),t._v("。")])]),t._v(" "),a("p",[t._v("好了，又进一步理解了执行上下文，那本节我们就在这基础之上继续深入，一起聊聊调用栈。学习调用栈至少有以下三点好处：")]),t._v(" "),a("ul",[a("li",[t._v("可以帮助你了解"),a("code",[t._v("JavaScript")]),t._v("引擎背后的工作原理；")]),t._v(" "),a("li",[t._v("让你有调试"),a("code",[t._v("JavaScript")]),t._v("代码的能力；")]),t._v(" "),a("li",[t._v("帮助你搞定面试，因为面试过程中，调用栈也是出境率非常高的题目")])]),t._v(" "),a("p",[t._v("比如你在写"),a("code",[t._v("JavaScript")]),t._v("代码的时候，有时候可能会遇到栈溢出的错误，如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/1.png",alt:""}})]),t._v(" "),a("p",[t._v("那为什么会出现这种错误呢？这就涉及到了调用栈的内容。你应该知道"),a("code",[t._v("JavaScript")]),t._v("中有很多函数，经常会出现在一个函数中调用另外一个函数的情况，调用栈就是用来管理函数调用关系的一种数据结构。因此要讲清楚调用栈，你还要先弄明白函数调用和栈结构")]),t._v(" "),a("h2",{attrs:{id:"什么是函数调用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是函数调用"}},[t._v("#")]),t._v(" 什么是函数调用")]),t._v(" "),a("p",[t._v("函数调用就是运行一个函数，具体使用方式是使用函数名称跟着一对小括号。下面我们看个简单的示例代码")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("  a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("b\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("这段代码很简单，先是创建了一个"),a("code",[t._v("add")]),t._v("函数，接着在代码的最下面又调用了该函数。")]),t._v(" "),a("p",[t._v("那么下面我们就利用这段简单的代码来解释下函数调用的过程。")]),t._v(" "),a("p",[t._v("在执行到函数"),a("code",[t._v("add()")]),t._v("之前，"),a("code",[t._v("JavaScript")]),t._v("引擎会为上面这段代码创建全局执行上下文，包含了声明的"),a("strong",[t._v("函数")]),t._v("和"),a("strong",[t._v("变量")]),t._v("，你可以参考下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/2.png",alt:""}})]),t._v(" "),a("p",[t._v("从图中可以看出，代码中全局变量和函数都保存在全局上下文的变量环境中。")]),t._v(" "),a("p",[t._v("执行上下文准备好之后，便开始执行全局代码，当执行到"),a("code",[t._v("add")]),t._v("这儿时，"),a("code",[t._v("JavaScript")]),t._v("判断这是一个函数调用，那么将执行以下操作：")]),t._v(" "),a("ul",[a("li",[t._v("首先，从全局执行上下文中，取出"),a("code",[t._v("add")]),t._v("函数代码。")]),t._v(" "),a("li",[t._v("其次，对"),a("code",[t._v("add")]),t._v("函数的这段代码进行"),a("strong",[t._v("编译")]),t._v("，并创建该函数的"),a("strong",[t._v("执行上下文")]),t._v("和"),a("strong",[t._v("可执行代码")]),t._v("。")])]),t._v(" "),a("blockquote",[a("p",[t._v("即编译时才会创建执行上下文和可执行代码，而执行上下文中包含了变量环境对象和词法环境；")])]),t._v(" "),a("ul",[a("li",[t._v("最后，执行代码，输出结果。")])]),t._v(" "),a("p",[t._v("完整流程你可以参考下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/3.png",alt:""}})]),t._v(" "),a("p",[t._v("就这样，当执行到"),a("code",[t._v("add")]),t._v("函数的时候，我们就有了"),a("strong",[t._v("两个执行上下文")]),t._v("了——全局执行上下文和"),a("code",[t._v("add")]),t._v("函数的执行上下文。")]),t._v(" "),a("p",[t._v("也就是说在执行"),a("code",[t._v("JavaScript")]),t._v("时，可能会存在多个执行上下文，那么"),a("code",[t._v("JavaScript")]),t._v("引擎是如何管理这些执行上下文的呢？")]),t._v(" "),a("p",[t._v("答案是通过一种叫"),a("strong",[t._v("栈的数据结构来管理的")]),t._v("。那什么是栈呢？它又是如何管理这些执行上下文呢？")]),t._v(" "),a("h2",{attrs:{id:"什么是栈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是栈"}},[t._v("#")]),t._v(" 什么是栈")]),t._v(" "),a("p",[t._v("关于栈，你可以结合这么一个贴切的例子来理解，一条单车道的单行线，一端被堵住了，而另一端入口处没有任何提示信息，堵住之后就只能后进去的车子先出来，这时这个堵住的单行线就可以被看作是一个栈容器，车子开进单行线的操作叫做入栈，车子倒出去的操作叫做出栈。")]),t._v(" "),a("p",[t._v("在车流量较大的场景中，就会发生反复的入栈、栈满、出栈、空栈和再次入栈，一直循环。")]),t._v(" "),a("p",[t._v("所以，栈就是类似于一端被堵住的单行线，车子类似于栈中的元素，栈中的元素满足后进先出的特点。你可以参看下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/4.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"什么是javascript的调用栈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是javascript的调用栈"}},[t._v("#")]),t._v(" 什么是"),a("code",[t._v("JavaScript")]),t._v("的调用栈")]),t._v(" "),a("p",[a("code",[t._v("JavaScript")]),t._v("引擎正是利用"),a("strong",[t._v("栈")]),t._v("的这种结构来"),a("strong",[t._v("管理执行上下文")]),t._v("的。在执行上下文"),a("strong",[t._v("创建好后")]),t._v("，"),a("code",[t._v("JavaScript")]),t._v("引擎会将执行上下文"),a("strong",[t._v("压入栈")]),t._v("中，通常把这种用来管理执行上下文的栈称为"),a("strong",[t._v("执行上下文栈")]),t._v("，又称"),a("strong",[t._v("调用栈")]),t._v("。")]),t._v(" "),a("p",[t._v("为便于你更好地理解调用栈，下面我们再来看段稍微复杂点的示例代码：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("c\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" d "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\nresult "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("  a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("result"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("d\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("在上面这段代码中，你可以看到它是在"),a("code",[t._v("addAll")]),t._v("函数中调用了"),a("code",[t._v("add")]),t._v("函数，那在整个代码的执行过程中，调用栈是怎么变化的呢？")]),t._v(" "),a("p",[t._v("下面我们就一步步地分析在代码的执行过程中，调用栈的状态变化情况。")]),t._v(" "),a("p",[a("strong",[t._v("第一步，创建全局上下文，并将其压入栈底")]),t._v("。如下图所示")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/5.png",alt:""}})]),t._v(" "),a("p",[t._v("从图中你也可以看出，变量"),a("code",[t._v("a")]),t._v("、函数"),a("code",[t._v("add")]),t._v("和"),a("code",[t._v("addAll")]),t._v("都保存到了全局上下文的"),a("strong",[t._v("变量环境对象")]),t._v("中。")]),t._v(" "),a("p",[t._v("全局执行上下文压入到调用栈后，"),a("code",[t._v("JavaScript")]),t._v("引擎便开始执行全局代码了。首先会执行"),a("code",[t._v("a=2")]),t._v("的赋值操作，执行该语句会将全局上下文变量环境中"),a("code",[t._v("a")]),t._v("的值设置为"),a("code",[t._v("2")]),t._v("。设置后的全局上下文的状态如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/6.png",alt:""}})]),t._v(" "),a("blockquote",[a("p",[t._v("注意了：这里刚开始执行全局代码的时候会创建一个全局执行上下文，首先将所有的代码遍历一遍，将变量和函数定义放入该执行上下文的变量环境对象中。然后再按顺序执行与全局执行上下文配套的全局可执行代码，由于对"),a("code",[t._v("a")]),t._v("的赋值比调用函数"),a("code",[t._v("AddAll")]),t._v("早，所以会先给"),a("code",[t._v("a")]),t._v("赋值，再调用"),a("code",[t._v("AddAll")]),t._v("函数，编译时创建"),a("code",[t._v("AddAll")]),t._v("的函数执行上下文和对应的可执行代码，然后重复上述过程；")])]),t._v(" "),a("p",[t._v("接下来，"),a("strong",[t._v("第二步是调用"),a("code",[t._v("addAll")]),t._v("函数")]),t._v("。当调用该函数时，"),a("code",[t._v("JavaScript")]),t._v("引擎会编译该函数，并为其创建一个执行上下文，最后还将该函数的执行上下文压入栈中，如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/7.png",alt:""}})]),t._v(" "),a("p",[a("code",[t._v("addAll")]),t._v("函数的执行上下文创建好之后，便进入了函数"),a("strong",[t._v("可执行代码")]),t._v("的执行阶段了，这里先执行的是"),a("code",[t._v("d=10")]),t._v("的赋值操作，执行语句会将"),a("code",[t._v("addAll")]),t._v("函数执行上下文中的"),a("code",[t._v("d")]),t._v("由"),a("code",[t._v("undefined")]),t._v("变成了"),a("code",[t._v("10")]),t._v("。")]),t._v(" "),a("p",[t._v("然后接着往下执行，"),a("strong",[t._v("第三步，当执行到"),a("code",[t._v("add")]),t._v("函数调用语句时，同样会为其创建执行上下文，并将其压入调用栈")]),t._v("，如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/8.png",alt:""}})]),t._v(" "),a("p",[t._v("当"),a("code",[t._v("add")]),t._v("函数返回时，该函数的执行上下文就会从栈顶弹出，并将"),a("code",[t._v("result")]),t._v("的值设置为"),a("code",[t._v("add")]),t._v("函数的返回值，也就是"),a("code",[t._v("9")]),t._v("。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/9.png",alt:""}})]),t._v(" "),a("p",[t._v("紧接着"),a("code",[t._v("addAll")]),t._v("执行最后一个相加操作后并返回，"),a("code",[t._v("addAll")]),t._v("的执行上下文也会从栈顶部弹出，此时调用栈中就只剩下全局上下文了。最终如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/10.png",alt:""}})]),t._v(" "),a("p",[t._v("至此，整个"),a("code",[t._v("JavaScript")]),t._v("流程执行结束了。")]),t._v(" "),a("p",[t._v("好了，现在你应该知道了"),a("strong",[t._v("调用栈是"),a("code",[t._v("JavaScript")]),t._v("引擎追踪函数执行的一个机制")]),t._v("，当一次有多个函数被调用时，通过调用栈就能够追踪到哪个函数正在被执行以及各函数之间的调用关系。")]),t._v(" "),a("h2",{attrs:{id:"在开发中，如何利用好调用栈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在开发中，如何利用好调用栈"}},[t._v("#")]),t._v(" 在开发中，如何利用好调用栈")]),t._v(" "),a("p",[t._v("鉴于调用栈的重要性和实用性，那么接下来我们就一起来看看在实际工作中，应该如何查看和利用好调用栈。")]),t._v(" "),a("h3",{attrs:{id:"_1-如何利用浏览器查看调用栈的信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-如何利用浏览器查看调用栈的信息"}},[t._v("#")]),t._v(" 1. 如何利用浏览器查看调用栈的信息")]),t._v(" "),a("p",[t._v("当你执行一段复杂的代码时，你可能很难从代码文件中分析其调用关系，这时候你可以在你想要查看的函数中加入断点，然后当执行到该函数时，就可以查看该函数的调用栈了。")]),t._v(" "),a("p",[t._v("这么说可能有点抽象，这里我们拿上面的那段代码做个演示，你可以打开“开发者工具”，点击“"),a("code",[t._v("Source")]),t._v("”标签，选择"),a("code",[t._v("JavaScript")]),t._v("代码的页面，然后在第"),a("code",[t._v("3")]),t._v("行加上断点，并刷新页面。你可以看到执行到add函数时，执行流程就暂停了，这时可以通过右边“"),a("code",[t._v("call stack")]),t._v("”来查看当前的调用栈的情况，如下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/11.png",alt:""}})]),t._v(" "),a("p",[t._v("从图中可以看出，右边的“"),a("code",[t._v("call stack")]),t._v("”下面显示出来了函数的调用关系：栈的最底部是"),a("code",[t._v("anonymous")]),t._v("，也就是"),a("strong",[t._v("全局的函数入口")]),t._v("；中间是"),a("code",[t._v("addAll")]),t._v("函数；顶部是"),a("code",[t._v("add")]),t._v("函数。这就清晰地反映了函数的调用关系，所以在分析复杂结构代码，或者检查"),a("code",[t._v("Bug")]),t._v("时，调用栈都是非常有用的。")]),t._v(" "),a("p",[t._v("除了通过断点来查看调用栈，你还可以使用"),a("code",[t._v("console.trace()")]),t._v("来输出当前的函数调用关系，比如在示例代码中的"),a("code",[t._v("add")]),t._v("函数里面加上了"),a("code",[t._v("console.trace()")]),t._v("，你就可以看到控制台输出的结果，如下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/12.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_2-栈溢出（stack-overflow）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-栈溢出（stack-overflow）"}},[t._v("#")]),t._v(" 2. 栈溢出（"),a("code",[t._v("Stack Overflow")]),t._v("）")]),t._v(" "),a("p",[t._v("现在你知道了"),a("strong",[t._v("调用栈")]),t._v("是一种用来"),a("strong",[t._v("管理执行上下文")]),t._v("的数据结构，符合"),a("strong",[t._v("后进先出")]),t._v("的规则。不过还有一点你要注意，"),a("strong",[t._v("调用栈是有大小的")]),t._v("，当入栈的执行上下文超过一定数目，"),a("code",[t._v("JavaScript")]),t._v("引擎就会报错，我们把这种错误叫做"),a("strong",[t._v("栈溢出")]),t._v("。")]),t._v(" "),a("p",[t._v("特别是在你写递归代码的时候，就很容易出现"),a("strong",[t._v("栈溢出")]),t._v("的情况。比如下面这段代码：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("division")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("division")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("division")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("当执行时，就会抛出栈溢出错误，如下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls8/13.png",alt:""}})]),t._v(" "),a("p",[t._v("从上图你可以看到，抛出的错误信息为：超过了最大栈调用大小（"),a("code",[t._v("Maximum call stack size exceeded")]),t._v("）。")]),t._v(" "),a("p",[t._v("那为什么会出现这个问题呢？这是因为当"),a("code",[t._v("JavaScript")]),t._v("引擎开始执行这段代码时，它首先调用函数"),a("code",[t._v("division")]),t._v("，并创建执行上下文，压入栈中；然而，这个函数是递归的，并且没有任何终止条件，所以它会一直创建新的函数执行上下文，并反复将其压入栈中，但"),a("strong",[t._v("栈是有容量限制")]),t._v("的，超过最大数量后就会出现栈溢出的错误。")]),t._v(" "),a("p",[t._v("理解了栈溢出原因后，你就可以使用一些方法来避免或者解决栈溢出的问题，比如把递归调用的形式改造成其他形式，或者使用加入定时器的方法来把当前任务拆分为其他很多小任务。")]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("好了，今天的内容就讲到这里，下面来总结下今天的内容。")]),t._v(" "),a("ul",[a("li",[t._v("每调用一个函数，"),a("code",[t._v("JavaScript")]),t._v("引擎会为其创建"),a("strong",[t._v("执行上下文")]),t._v("，并把该执行上下文"),a("strong",[t._v("压入调用栈")]),t._v("，然后"),a("code",[t._v("JavaScript")]),t._v("引擎开始执行函数代码（函数执行上下文对应的可执行代码）。")]),t._v(" "),a("li",[t._v("如果在一个函数"),a("code",[t._v("A")]),t._v("中调用了另外一个函数"),a("code",[t._v("B")]),t._v("，那么"),a("code",[t._v("JavaScript")]),t._v("引擎会为"),a("code",[t._v("B")]),t._v("函数创建执行上下文，并将"),a("code",[t._v("B")]),t._v("函数的执行上下文压入栈顶。")]),t._v(" "),a("li",[t._v("当前函数执行完毕后，"),a("code",[t._v("JavaScript")]),t._v("引擎会将该函数的执行上下文弹出栈。")]),t._v(" "),a("li",[t._v("当分配的调用栈空间被占满时，会引发“"),a("strong",[t._v("堆栈溢出")]),t._v("”问题。")]),t._v(" "),a("li",[t._v("栈是一种非常重要的数据结构，不光应用在"),a("code",[t._v("JavaScript")]),t._v("语言中，其他的编程语言，如"),a("code",[t._v("C/C++")]),t._v("、"),a("code",[t._v("Java")]),t._v("、"),a("code",[t._v("Python")]),t._v("等语言，在执行过程中也都使用了栈来管理函数之间的调用关系。所以栈是非常基础且重要的知识点，你必须得掌握。")])]),t._v(" "),a("h2",{attrs:{id:"思考时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思考时间"}},[t._v("#")]),t._v(" 思考时间")]),t._v(" "),a("p",[t._v("最后，我给你留个思考题，你可以看下面这段代码：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("function runStack (n) {\n  if (n === 0) return 100;\n  return runStack( n- 2);\n}\nrunStack(50000)\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("这是一段递归代码，可以通过传入参数"),a("code",[t._v("n")]),t._v("，让代码递归执行"),a("code",[t._v("n")]),t._v("次，也就意味着调用栈的深度能达到"),a("code",[t._v("n")]),t._v("，当输入一个较大的数时，比如"),a("code",[t._v("50000")]),t._v("，就会出现栈溢出的问题，那么你能优化下这段代码，以解决栈溢出的问题吗？")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 优化")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("runStack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("n")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 防止陷入死循环")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("runStack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])])])}),[],!1,null,null,null);s.default=v.exports}}]);