(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{459:function(s,t,a){"use strict";a.r(t);var n=a(27),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_11-this：从javascript执行上下文视角讲this"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-this：从javascript执行上下文视角讲this"}},[s._v("#")]),s._v(" 11.this：从JavaScript执行上下文视角讲this")]),s._v(" "),a("p",[s._v("在上篇文章中，我们讲了词法作用域、作用域链以及闭包，并在最后思考题中留了下面这样一段代码")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" bar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    myName"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time.geekbang.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("printName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("myName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" myName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客时间 "')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" bar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("printName\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" myName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客邦 "')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" _printName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_printName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("相信你已经知道了，在 "),a("code",[s._v("printName")]),s._v(" 函数里面使用的变量 "),a("code",[s._v("myName")]),s._v(" 是属于全局作用域下面的，所以最终打印出来的值都是“极客邦”。这是因为 "),a("code",[s._v("JavaScript")]),s._v(" 语言的"),a("strong",[s._v("作用域链")]),s._v("是由"),a("strong",[s._v("词法作用域")]),s._v("决定的，而"),a("strong",[s._v("词法作用域")]),s._v("是由"),a("strong",[s._v("代码结构")]),s._v("来确定的。")]),s._v(" "),a("p",[s._v("不过按照常理来说，调用"),a("code",[s._v("bar.printName")]),s._v("方法时，该方法内部的变量 "),a("code",[s._v("myName")]),s._v(" 应该使用 "),a("code",[s._v("bar")]),s._v(" 对象中的，因为它们是一个整体，大多数面向对象语言都是这样设计的，比如我用 "),a("code",[s._v("C++")]),s._v(" 改写了上面那段代码，如下所示：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[s._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<iostream>")])]),s._v("\nusing namespace std"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nclass Bar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    public"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" myName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      myName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time.geekbang.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       cout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" myName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("endl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" bar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" myName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客邦 "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tbar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("在这段 "),a("code",[s._v("C++")]),s._v(" 代码中，我同样调用了 "),a("code",[s._v("bar")]),s._v(" 对象中的 "),a("code",[s._v("printName")]),s._v(" 方法，最后打印出来的值就是 "),a("code",[s._v("bar")]),s._v(" 对象的内部变量 "),a("code",[s._v("myName")]),s._v(" 值——“"),a("code",[s._v("time.geekbang.com")]),s._v("”，而并不是最外面定义变量 "),a("code",[s._v("myName")]),s._v(" 的值——“极客邦”，所以在对象内部的方法中使用对象内部的属性是一个非常普遍的需求。但是 "),a("code",[s._v("JavaScript")]),s._v(" 的作用域机制并不支持这一点，基于这个需求，"),a("code",[s._v("JavaScript")]),s._v(" 又搞出来另外一套"),a("code",[s._v("this")]),s._v(" 机制。")]),s._v(" "),a("p",[s._v("所以，在 "),a("code",[s._v("JavaScript")]),s._v(" 中可以使用 "),a("code",[s._v("this")]),s._v(" 实现在 "),a("code",[s._v("printName")]),s._v(" 函数中访问到 "),a("code",[s._v("bar")]),s._v(" 对象的 "),a("code",[s._v("myName")]),s._v(" 属性了。具体该怎么操作呢？你可以调整 "),a("code",[s._v("printName")]),s._v(" 的代码，如下所示：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("printName: function () {\n  console.log(this.myName)\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("接下来咱们就展开来介绍 "),a("code",[s._v("this")]),s._v("，不过在讲解之前，希望你能区分清楚"),a("strong",[s._v("作用域链")]),s._v("和**"),a("code",[s._v("this")]),s._v("是两套不同的系统**，它们之间基本"),a("strong",[s._v("没太多联系")]),s._v("。在前期明确这点，可以避免你在学习 "),a("code",[s._v("this")]),s._v(" 的过程中，和作用域产生一些不必要的关联。")]),s._v(" "),a("h2",{attrs:{id:"javascript-中的-this-是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#javascript-中的-this-是什么"}},[s._v("#")]),s._v(" "),a("code",[s._v("JavaScript")]),s._v(" 中的 "),a("code",[s._v("this")]),s._v(" 是什么")]),s._v(" "),a("p",[s._v("关于 "),a("code",[s._v("this")]),s._v("，我们还是得先从执行上下文说起。在前面几篇文章中，我们提到执行上下文中包含了"),a("strong",[s._v("变量环境")]),s._v("、"),a("strong",[s._v("词法环境")]),s._v("、"),a("strong",[s._v("外部环境")]),s._v("，但其实还有一个 "),a("code",[s._v("this")]),s._v(" 没有提及，具体你可以参考下图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part2/ls11/1.png",alt:""}})]),s._v(" "),a("p",[s._v("从图中可以看出，"),a("code",[s._v("this")]),s._v(" 是和"),a("strong",[s._v("执行上下文绑定")]),s._v("的，也就是说每个执行上下文中都有一个 "),a("code",[s._v("this")]),s._v("。前面《"),a("code",[s._v("08")]),s._v(" | 调用栈：为什么 "),a("code",[s._v("JavaScript")]),s._v(" 代码会出现栈溢出？》中我们提到过，"),a("strong",[s._v("执行上下文")]),s._v("主要分为三种——"),a("strong",[s._v("全局执行上下文")]),s._v("、"),a("strong",[s._v("函数执行上下文")]),s._v("和 "),a("strong",[a("code",[s._v("eval")]),s._v(" 执行上下文")]),s._v("，所以对应的 "),a("code",[s._v("this")]),s._v(" 也只有这三种——全局执行上下文中的 "),a("code",[s._v("this")]),s._v("、函数中的 "),a("code",[s._v("this")]),s._v(" 和 "),a("code",[s._v("eval")]),s._v(" 中的 "),a("code",[s._v("this")]),s._v("。")]),s._v(" "),a("p",[s._v("那么接下来我们就重点讲解下全局执行上下文中的 "),a("code",[s._v("this")]),s._v("和函数执行上下文中的 "),a("code",[s._v("this")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"全局执行上下文中的-this"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局执行上下文中的-this"}},[s._v("#")]),s._v(" 全局执行上下文中的 "),a("code",[s._v("this")])]),s._v(" "),a("p",[s._v("首先我们来看看全局执行上下文中的 "),a("code",[s._v("this")]),s._v(" 是什么。")]),s._v(" "),a("p",[s._v("你可以在控制台中输入"),a("code",[s._v("console.log(this)")]),s._v("来打印出来全局执行上下文中的 "),a("code",[s._v("this")]),s._v("，最终输出的是 "),a("code",[s._v("window")]),s._v(" 对象。所以你可以得出这样一个结论：全局执行上下文中的 "),a("code",[s._v("this")]),s._v(" 是"),a("strong",[s._v("指向 "),a("code",[s._v("window")]),s._v(" 对象")]),s._v("的。"),a("strong",[s._v("这也是 "),a("code",[s._v("this")]),s._v(" 和作用域链的唯一交点")]),s._v("，作用域链的最底端包含了 "),a("code",[s._v("window")]),s._v(" 对象，全局执行上下文中的 "),a("code",[s._v("this")]),s._v(" 也是指向 "),a("code",[s._v("window")]),s._v("对象")]),s._v(" "),a("h2",{attrs:{id:"函数执行上下文中的-this"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#函数执行上下文中的-this"}},[s._v("#")]),s._v(" 函数执行上下文中的 "),a("code",[s._v("this")])]),s._v(" "),a("p",[s._v("现在你已经知道全局对象中的"),a("code",[s._v("this")]),s._v(" 是指向 "),a("code",[s._v("window")]),s._v("对象了，那么接下来，我们就来重点分析函数执行上下文中的 "),a("code",[s._v("this")]),s._v("。还是先看下面这段代码：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("我们在 "),a("code",[s._v("foo")]),s._v(" 函数内部打印出来 "),a("code",[s._v("this")]),s._v(" 值，执行这段代码，打印出来的也是 "),a("code",[s._v("window")]),s._v(" 对象，这说明在默认情况下调用一个函数，其执行上下文中的 "),a("code",[s._v("this")]),s._v(" 也是指向 "),a("code",[s._v("window")]),s._v(" 对象的。估计你会好奇，那能不能设置执行上下文中的 "),a("code",[s._v("this")]),s._v(" 来指向其他对象呢？答案是肯定的。通常情况下，有下面三种方式来设置函数执行上下文中的 "),a("code",[s._v("this")]),s._v(" 值")])]),s._v(" "),a("p",[a("strong",[s._v("1. 通过函数的 "),a("code",[s._v("call")]),s._v(" 方法设置")])]),s._v(" "),a("p",[s._v("你可以通过函数的"),a("code",[s._v("call")]),s._v("方法来设置函数执行上下文的 "),a("code",[s._v("this")]),s._v(" 指向，比如下面这段代码，我们就并没有直接调用 "),a("code",[s._v("foo")]),s._v(" 函数，而是调用了 "),a("code",[s._v("foo")]),s._v(" 的 "),a("code",[s._v("call")]),s._v(" 方法，并将 "),a("code",[s._v("bar")]),s._v(" 对象作为 "),a("code",[s._v("call")]),s._v(" 方法的参数")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" bar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  myName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客邦 "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  test1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("myName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客时间 "')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("myName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("执行这段代码，然后观察输出结果，你就能发现 "),a("code",[s._v("foo")]),s._v(" 函数内部的 "),a("code",[s._v("this")]),s._v(" 已经指向了 "),a("code",[s._v("bar")]),s._v(" 对象，因为通过打印 "),a("code",[s._v("bar")]),s._v(" 对象，可以看出 "),a("code",[s._v("bar")]),s._v(" 的 "),a("code",[s._v("myName")]),s._v(" 属性已经由“极客邦”变为“极客时间”了，同时在全局执行上下文中打印 "),a("code",[s._v("myName")]),s._v("，"),a("code",[s._v("JavaScript")]),s._v(" 引擎提示该变量未定义。")]),s._v(" "),a("p",[s._v("其实除了 "),a("code",[s._v("call")]),s._v(" 方法，你还可以使用"),a("code",[s._v("bind")]),s._v("和"),a("code",[s._v("apply")]),s._v("方法来设置函数执行上下文中的 "),a("code",[s._v("this")]),s._v("，它们在使用上还是有一些区别的，如果感兴趣你可以自行搜索和学习它们的使用方法，这里我就不再赘述了。")]),s._v(" "),a("p",[a("strong",[s._v("2. 通过对象调用方法设置")])]),s._v(" "),a("p",[s._v("要改变函数执行上下文中的 "),a("code",[s._v("this")]),s._v(" 指向，除了通过函数的 "),a("code",[s._v("call")]),s._v(" 方法来实现外，还可以通过对象调用的方式，比如下面这段代码：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" myObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客时间 "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("showThis")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nmyObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("showThis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("在这段代码中，我们定义了一个 "),a("code",[s._v("myObj")]),s._v(" 对象，该对象是由一个 "),a("code",[s._v("name")]),s._v(" 属性和一个 "),a("code",[s._v("showThis")]),s._v(" 方法组成的，然后再通过 "),a("code",[s._v("myObj")]),s._v(" 对象来调用 "),a("code",[s._v("showThis")]),s._v(" 方法。执行这段代码，你可以看到，最终输出的 "),a("code",[s._v("this")]),s._v(" 值是指向 "),a("code",[s._v("myObj")]),s._v(" 的。")]),s._v(" "),a("p",[s._v("所以，你可以得出这样的结论："),a("strong",[s._v("使用对象来调用其内部的一个方法，该方法的 "),a("code",[s._v("this")]),s._v(" 是指向对象本身的。")])]),s._v(" "),a("p",[s._v("其实，你也可以认为 "),a("code",[s._v("JavaScript")]),s._v(" 引擎在执行"),a("code",[s._v("myObject.showThis()")]),s._v("时，将其转化为了：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("myObj.showThis.call(myObj)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("接下来我们稍微改变下调用方式，把 "),a("code",[s._v("showThis")]),s._v(" 赋给一个全局对象，然后再调用该对象，代码如下所示：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" myObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客时间 "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("showThis")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客邦 "')]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" foo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" myObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("showThis\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("执行这段代码，你会发现 "),a("code",[s._v("this")]),s._v(" 又指向了全局 "),a("code",[s._v("window")]),s._v(" 对象。所以通过以上两个例子的对比，你可以得出下面这样两个结论：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在"),a("strong",[s._v("全局环境中调用")]),s._v("一个函数，函数内部的 "),a("code",[s._v("this")]),s._v(" 指向的是全局变量 "),a("code",[s._v("window")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("通过一个对象来调用")]),s._v("其内部的一个方法，该方法的执行上下文中的 "),a("code",[s._v("this")]),s._v(" 指向对象本身。")])])]),s._v(" "),a("blockquote",[a("p",[s._v("谁调用它就指向谁。")])]),s._v(" "),a("p",[a("strong",[s._v("3. 通过构造函数中设置")])]),s._v(" "),a("p",[s._v("你可以像这样设置构造函数中的"),a("code",[s._v("this")]),s._v("，如下面的示例代码")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateObj")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客时间 "')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" myObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CreateObj")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("在这段代码中，我们使用 "),a("code",[s._v("new")]),s._v(" 创建了对象 "),a("code",[s._v("myObj")]),s._v("，那你知道此时的构造函数 "),a("code",[s._v("CreateObj")]),s._v(" 中的 "),a("code",[s._v("this")]),s._v(" 到底指向了谁吗？")]),s._v(" "),a("p",[s._v("其实，当执行 "),a("code",[s._v("new CreateObj()")]),s._v(" 的时候，"),a("code",[s._v("JavaScript")]),s._v(" 引擎做了如下四件事：")]),s._v(" "),a("ul",[a("li",[s._v("首先创建了一个空对象 "),a("code",[s._v("tempObj")]),s._v("；")]),s._v(" "),a("li",[s._v("接着调用 "),a("code",[s._v("CreateObj.call")]),s._v(" 方法，并将 "),a("code",[s._v("tempObj")]),s._v(" 作为 "),a("code",[s._v("call")]),s._v(" 方法的参数，这样当 "),a("code",[s._v("CreateObj")]),s._v(" 的执行上下文创建时，它的 "),a("code",[s._v("this")]),s._v(" 就指向了 "),a("code",[s._v("tempObj")]),s._v(" 对象；")]),s._v(" "),a("li",[s._v("然后执行 "),a("code",[s._v("CreateObj")]),s._v(" 函数，此时的 "),a("code",[s._v("CreateObj")]),s._v(" 函数执行上下文中的 "),a("code",[s._v("this")]),s._v(" 是指向 "),a("code",[s._v("tempObj")]),s._v(" 对象的，所以相当于该"),a("code",[s._v("tempObj")]),s._v("添加属性，所以"),a("code",[s._v("CreateObj")]),s._v("被称为构造函数；")]),s._v(" "),a("li",[s._v("最后返回 "),a("code",[s._v("tempObj")]),s._v(" 对象。")])]),s._v(" "),a("p",[s._v("为了直观理解，我们可以用代码来演示下")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" tempObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateObj")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tempObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" tempObj\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("这样，我们就通过 "),a("code",[s._v("new")]),s._v(" 关键字构建好了一个新对象，并且构造函数中的 "),a("code",[s._v("this")]),s._v(" 其实就是新对象本身。")]),s._v(" "),a("h2",{attrs:{id:"this-的设计缺陷以及应对方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#this-的设计缺陷以及应对方案"}},[s._v("#")]),s._v(" "),a("code",[s._v("this")]),s._v(" 的设计缺陷以及应对方案")]),s._v(" "),a("p",[s._v("就我个人而言，"),a("code",[s._v("this")]),s._v(" 并不是一个很好的设计，因为它的很多使用方法都"),a("strong",[s._v("冲击人的直觉")]),s._v("，在使用过程中存在着非常多的坑。下面咱们就来一起看看那些 "),a("code",[s._v("this")]),s._v(" 设计缺陷。")]),s._v(" "),a("p",[a("strong",[s._v("1. 嵌套函数中的 this 不会从外层函数中继承")])]),s._v(" "),a("p",[s._v("我认为这是一个严重的设计错误，并影响了后来的很多开发者，让他们“前赴后继”迷失在该错误中。我们还是结合下面这样一段代码来分析下：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" myObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客时间 "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("showThis")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nmyObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("showThis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("我们在这段代码的 "),a("code",[s._v("showThis")]),s._v(" 方法里面添加了一个 "),a("code",[s._v("bar")]),s._v(" 方法，然后接着在 "),a("code",[s._v("showThis")]),s._v(" 函数中调用了 "),a("code",[s._v("bar")]),s._v(" 函数，那么现在的问题是："),a("code",[s._v("bar")]),s._v(" 函数中的 "),a("code",[s._v("this")]),s._v(" 是什么？")]),s._v(" "),a("p",[s._v("如果你是刚接触 "),a("code",[s._v("JavaScript")]),s._v("，那么你可能会很自然地觉得，"),a("code",[s._v("bar")]),s._v(" 中的 "),a("code",[s._v("this")]),s._v(" 应该和其外层 "),a("code",[s._v("showThis")]),s._v(" 函数中的 "),a("code",[s._v("this")]),s._v(" 是一致的，都是指向 "),a("code",[s._v("myObj")]),s._v(" 对象的，这很符合人的直觉。但实际情况却并非如此，执行这段代码后，你会发现函数 "),a("code",[s._v("bar")]),s._v(" 中的 "),a("code",[s._v("this")]),s._v(" 指向的是全局 "),a("code",[s._v("window")]),s._v(" 对象，而函数 "),a("code",[s._v("showThis")]),s._v(" 中的 "),a("code",[s._v("this")]),s._v(" 指向的是 "),a("code",[s._v("myObj")]),s._v(" 对象。这就是 "),a("code",[s._v("JavaScript")]),s._v(" 中非常容易让人迷惑的地方之一，也是很多问题的源头。")]),s._v(" "),a("p",[s._v("你可以通过一个小技巧来解决这个问题，比如在 "),a("code",[s._v("showThis")]),s._v(" 函数中声明一个变量 "),a("code",[s._v("self")]),s._v(" 用来保存 "),a("code",[s._v("this")]),s._v("，然后在 "),a("code",[s._v("bar")]),s._v(" 函数中使用 "),a("code",[s._v("self")]),s._v("，代码如下所示：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" myObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客时间 "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("showThis")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" self "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客邦 "')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nmyObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("showThis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("myObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("执行这段代码，你可以看到它输出了我们想要的结果，最终 "),a("code",[s._v("myObj")]),s._v(" 中的 "),a("code",[s._v("name")]),s._v(" 属性值变成了“极客邦”。其实，这个方法的的本质是把 "),a("code",[s._v("this")]),s._v(" 体系转换为了"),a("strong",[s._v("作用域")]),s._v("的体系。")]),s._v(" "),a("p",[s._v("其实，你也可以使用 "),a("code",[s._v("ES6")]),s._v(" 中的箭头函数来解决这个问题，结合下面代码：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" myObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客时间 "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("showThis")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//myObj")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("bar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 极客邦 "')]),s._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//myObj")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nmyObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("showThis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("myObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//极客邦")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//极客邦")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("执行这段代码，你会发现它也输出了我们想要的结果，也就是箭头函数 "),a("code",[s._v("bar")]),s._v(" 里面的 "),a("code",[s._v("this")]),s._v(" 是指向 "),a("code",[s._v("myObj")]),s._v(" 对象的。这是因为 "),a("code",[s._v("ES6")]),s._v(" 中的箭头函数并"),a("strong",[s._v("不会创建其自身的执行上下文")]),s._v("，所以箭头函数中的 "),a("code",[s._v("this")]),s._v(" 取决于它的外部函数。")]),s._v(" "),a("p",[s._v("通过上面的讲解，你现在应该知道了 "),a("code",[s._v("this")]),s._v(" "),a("strong",[s._v("没有作用域的限制")]),s._v("，这点和变量不一样，"),a("strong",[s._v("所以嵌套函数不会从调用它的函数中继承 "),a("code",[s._v("this")])]),s._v("，这样会造成很多不符合直觉的代码。要解决这个问题，你可以有两种思路：")]),s._v(" "),a("ul",[a("li",[s._v("第一种是把 "),a("code",[s._v("this")]),s._v(" 保存为一个 "),a("code",[s._v("self")]),s._v(" 变量，再利用变量的"),a("strong",[s._v("作用域机制")]),s._v("传递给嵌套函数。")]),s._v(" "),a("li",[s._v("第二种是继续使用 "),a("code",[s._v("this")]),s._v("，但是要把嵌套函数改为"),a("strong",[s._v("箭头函数")]),s._v("，因为箭头函数没有自己的执行上下文，所以它会继承调用函数中的 "),a("code",[s._v("this")])])]),s._v(" "),a("p",[a("strong",[s._v("2. 普通函数中的 "),a("code",[s._v("this")]),s._v(" 默认指向全局对象 "),a("code",[s._v("window")])])]),s._v(" "),a("p",[s._v("上面我们已经介绍过了，在默认情况下调用一个函数，其执行上下文中的 "),a("code",[s._v("this")]),s._v(" 是默认指向全局对象 "),a("code",[s._v("window")]),s._v(" 的。")]),s._v(" "),a("p",[s._v("不过这个设计也是一种缺陷，因为在实际工作中，我们并不希望函数执行上下文中的 "),a("code",[s._v("this")]),s._v(" 默认指向全局对象，因为这样会打破数据的边界，造成一些误操作。如果要让函数执行上下文中的 "),a("code",[s._v("this")]),s._v(" 指向某个对象，最好的方式是通过 "),a("code",[s._v("call")]),s._v(" 方法来显示调用。")]),s._v(" "),a("p",[s._v("这个问题可以通过设置 "),a("code",[s._v("JavaScript")]),s._v(" 的“严格模式”来解决。在严格模式下，默认执行一个函数，其函数的执行上下文中的 "),a("code",[s._v("this")]),s._v(" 值是 "),a("code",[s._v("undefined")]),s._v("，这就解决上面的问题了")]),s._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("好了，今天就到这里，下面我们来回顾下今天的内容。")]),s._v(" "),a("p",[s._v("首先，在使用 "),a("code",[s._v("this")]),s._v(" 时，为了避坑，你要谨记以下三点：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("当函数作为"),a("strong",[s._v("对象的方法调用")]),s._v("时，函数中的 "),a("code",[s._v("this")]),s._v(" 就是该对象；")])]),s._v(" "),a("li",[a("p",[s._v("当函数被"),a("strong",[s._v("正常调用")]),s._v("时，在严格模式下，"),a("code",[s._v("this")]),s._v(" 值是 "),a("code",[s._v("undefined")]),s._v("，非严格模式下 "),a("code",[s._v("this")]),s._v(" 指向的是全局对象 "),a("code",[s._v("window")]),s._v("；")])]),s._v(" "),a("li",[a("p",[s._v("嵌套函数中的 "),a("code",[s._v("this")]),s._v(" "),a("strong",[s._v("不会继承")]),s._v("外层函数的 "),a("code",[s._v("this")]),s._v(" 值。")])])]),s._v(" "),a("p",[s._v("最后，我们还提了一下箭头函数，因为箭头函数"),a("strong",[s._v("没有自己的执行上下文")]),s._v("，所以箭头函数的 "),a("code",[s._v("this")]),s._v("就是它"),a("strong",[s._v("外层函数的 "),a("code",[s._v("this")])]),s._v("。")]),s._v(" "),a("p",[s._v("这是我们“"),a("code",[s._v("JavaScript")]),s._v(" 执行机制”模块的最后一节了，五节下来，你应该已经发现我们将近一半的时间都是在谈 "),a("code",[s._v("JavaScript")]),s._v(" 的各种缺陷，比如变量提升带来的问题、"),a("code",[s._v("this")]),s._v(" 带来问题等。我认为了解一门语言的缺陷并不是为了否定它，相反是为了能更加深入地了解它。我们在谈论缺陷的过程中，还结合 "),a("code",[s._v("JavaScript")]),s._v(" 的工作流程分析了出现这些缺陷的原因，以及避开这些缺陷的方法。掌握了这些，相信你今后在使用 "),a("code",[s._v("JavaScript")]),s._v(" 的过程中会更加得心应手。")])])}),[],!1,null,null,null);t.default=e.exports}}]);