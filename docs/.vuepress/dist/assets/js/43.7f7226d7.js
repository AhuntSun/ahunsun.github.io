(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{476:function(v,_,e){"use strict";e.r(_);var o=e(27),r=Object(o.a)({},(function(){var v=this,_=v.$createElement,e=v._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("h1",{attrs:{id:"_27-pwa：解决了web应用哪些问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_27-pwa：解决了web应用哪些问题"}},[v._v("#")]),v._v(" 27.PWA：解决了web应用哪些问题")]),v._v(" "),e("p",[e("code",[v._v("PWA")]),v._v("，全称是 "),e("code",[v._v("Progressive Web App")]),v._v("，翻译过来就是"),e("strong",[v._v("渐进式网页应用")]),v._v("。根据字面意思，它就是“"),e("strong",[v._v("渐进式")]),v._v(" +"),e("code",[v._v("Web")]),v._v(" 应用”。对于 "),e("code",[v._v("Web")]),v._v(" 应用很好理解了，就是目前我们普通的 "),e("code",[v._v("Web")]),v._v(" 页面，所以 "),e("code",[v._v("PWA")]),v._v(" 所支持的首先是一个 "),e("code",[v._v("Web")]),v._v(" 页面。至于“"),e("strong",[v._v("渐进式")]),v._v("”，就需要从下面两个方面来理解。")]),v._v(" "),e("ul",[e("li",[v._v("站在 "),e("code",[v._v("Web")]),v._v(" 应用开发者来说，"),e("code",[v._v("PWA")]),v._v(" 提供了一个"),e("strong",[v._v("渐进式的过渡方案")]),v._v("，让普通站点逐步过渡到 "),e("code",[v._v("Web")]),v._v(" 应用。采取渐进式可以降低站点改造的代价，使得站点逐步支持各项新技术，而不是一步到位。")]),v._v(" "),e("li",[v._v("站在技术角度来说，"),e("code",[v._v("PWA")]),v._v(" 技术也是一个渐进式的演化过程，在技术层面会一点点演进，比如逐渐"),e("strong",[v._v("提供更好的设备特性支持")]),v._v("，"),e("strong",[v._v("不断优化更加流畅")]),v._v("的动画效果，不断让页面的"),e("strong",[v._v("加载速度变得更快")]),v._v("，不断实现"),e("strong",[v._v("本地应用的特性")]),v._v("。")])]),v._v(" "),e("p",[v._v("从这两点可以看出来，"),e("code",[v._v("PWA")]),v._v(" 采取的是非常一个缓和的渐进式策略，不再像以前那样激进，动不动就是取代本地"),e("code",[v._v("App")]),v._v("、取代小程序。与之相反，而是要充分发挥 "),e("code",[v._v("Web")]),v._v(" 的优势，渐进式地缩短和"),e("strong",[v._v("本地应用")]),v._v("或者"),e("strong",[v._v("小程序")]),v._v("的距离。")]),v._v(" "),e("p",[v._v("那么 "),e("code",[v._v("Web")]),v._v(" 最大的优势是什么呢？我认为是"),e("strong",[v._v("自由开放")]),v._v("，也正是因为自由和开放，所以大家就很容易对同一件事情达成共识，达成共识之后，一套代码就可以运行在各种设备之上了，这就是"),e("strong",[v._v("跨平台")]),v._v("，这也恰恰是本地应用所不具备的。而对于小程序，倒是可以实现跨平台，但要让各家达成共识，目前来看，似乎还是非常不切实际的。")]),v._v(" "),e("p",[v._v("所以我给 "),e("code",[v._v("PWA")]),v._v(" 的定义就是："),e("strong",[v._v("它是一套理念")]),v._v("，"),e("strong",[v._v("渐进式增强 "),e("code",[v._v("Web")]),v._v(" 的优势")]),v._v("，并通过技术手段"),e("strong",[v._v("渐进式缩短和本地应用或者小程序的距离")]),v._v("。基于这套"),e("strong",[v._v("理念")]),v._v("之下的技术都可以归类到 "),e("code",[v._v("PWA")]),v._v("。")]),v._v(" "),e("p",[v._v("那今天我们就主要来聊聊 "),e("code",[v._v("PWA")]),v._v(" 主要采用了哪些技术手段来"),e("strong",[v._v("缩短")]),v._v("它和"),e("strong",[v._v("本地应用")]),v._v("或者"),e("strong",[v._v("小程序")]),v._v("的"),e("strong",[v._v("距离")]),v._v("。")]),v._v(" "),e("h2",{attrs:{id:"web-应用-vs-本地应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-应用-vs-本地应用"}},[v._v("#")]),v._v(" "),e("code",[v._v("Web")]),v._v(" 应用 "),e("code",[v._v("VS")]),v._v(" 本地应用")]),v._v(" "),e("p",[v._v("那相对于本地应用，"),e("code",[v._v("Web")]),v._v(" 页面到底缺少了什么？")]),v._v(" "),e("ul",[e("li",[v._v("首先，"),e("code",[v._v("Web")]),v._v(" 应用"),e("strong",[v._v("缺少离线使用能力")]),v._v("，在离线或者在弱网环境下基本上是无法使用的。而用户需要的是沉浸式的体验，在离线或者弱网环境下能够流畅地使用是用户对一个应用的基本要求。")]),v._v(" "),e("li",[v._v("其次，"),e("code",[v._v("Web")]),v._v(" 应用还"),e("strong",[v._v("缺少了消息推送的能力")]),v._v("，因为作为一个 "),e("code",[v._v("App")]),v._v(" 厂商，需要有将消息送达到应用的能力。")]),v._v(" "),e("li",[v._v("最后，"),e("code",[v._v("Web")]),v._v(" 应用"),e("strong",[v._v("缺少一级入口")]),v._v("，也就是将 "),e("code",[v._v("Web")]),v._v(" 应用安装到桌面，在需要的时候直接从桌面打开 "),e("code",[v._v("Web")]),v._v(" 应用，而不是每次都需要通过浏览器来打开。")])]),v._v(" "),e("p",[v._v("针对以上 "),e("code",[v._v("Web")]),v._v(" 缺陷，"),e("code",[v._v("PWA")]),v._v(" 提出了两种解决方案：通过引入 "),e("code",[v._v("Service Worker")]),v._v(" 来试着"),e("strong",[v._v("解决离线存储")]),v._v("和"),e("strong",[v._v("消息推送")]),v._v("的问题，通过引入 "),e("code",[v._v("manifest.json")]),v._v(" 来"),e("strong",[v._v("解决一级入口")]),v._v("的问题。下面我们就来详细分析下 "),e("code",[v._v("Service Worker")]),v._v(" 是如何工作的。")]),v._v(" "),e("h2",{attrs:{id:"什么是-service-worker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么是-service-worker"}},[v._v("#")]),v._v(" 什么是 "),e("code",[v._v("Service Worker")])]),v._v(" "),e("p",[v._v("我们先来看看 "),e("code",[v._v("Service Worker")]),v._v(" 是怎么"),e("strong",[v._v("解决离线存储")]),v._v("和"),e("strong",[v._v("消息推送")]),v._v("的问题。")]),v._v(" "),e("p",[v._v("其实在 "),e("code",[v._v("Service Worker")]),v._v(" 之前，"),e("code",[v._v("WHATWG")]),v._v(" 小组就推出过用 "),e("code",[v._v("App Cache")]),v._v(" 标准来缓存页面，不过在使用过程中 "),e("code",[v._v("App Cache")]),v._v(" 所暴露的问题比较多，遭到多方吐槽，所以这个标准最终也只能被废弃了，可见一个成功的标准是需要经历实践考量的。")]),v._v(" "),e("p",[v._v("所以在 "),e("code",[v._v("2014")]),v._v(" 年的时候，标准委员会就提出了 "),e("code",[v._v("Service Worker")]),v._v(" 的概念，它的主要思想是"),e("strong",[v._v("在页面和网络之间增加一个拦截器")]),v._v("，用来"),e("strong",[v._v("缓存")]),v._v("和"),e("strong",[v._v("拦截请求")]),v._v("。整体结构如下图所示：")]),v._v(" "),e("p",[e("img",{attrs:{src:"http://ahuntsun.gitee.io/blogimagebed/img/browser/part5/ls27/1.png",alt:""}})]),v._v(" "),e("p",[v._v("在没有安装 "),e("code",[v._v("Service Worker")]),v._v(" 之前，"),e("code",[v._v("WebApp")]),v._v(" 都是直"),e("strong",[v._v("接通过网络模块")]),v._v("来"),e("strong",[v._v("请求资源")]),v._v("的。安装了 "),e("code",[v._v("Service Worker")]),v._v(" 模块之后，"),e("code",[v._v("WebApp")]),v._v(" 请求资源时，会"),e("strong",[v._v("先通过")]),v._v(" "),e("code",[v._v("Service Worker")]),v._v("，让它判断是"),e("strong",[v._v("返回 "),e("code",[v._v("Service Worker")]),v._v(" 缓存的资源")]),v._v("还是"),e("strong",[v._v("重新去网络请求资源")]),v._v("。一切的控制权都交由 "),e("code",[v._v("Service Worker")]),v._v(" 来处理。")]),v._v(" "),e("h2",{attrs:{id:"service-worker-的设计思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#service-worker-的设计思路"}},[v._v("#")]),v._v(" Service Worker 的设计思路")]),v._v(" "),e("p",[v._v("现在我们知道 "),e("code",[v._v("Service Worker")]),v._v("的主要功能就是"),e("strong",[v._v("拦截请求")]),v._v("和"),e("strong",[v._v("缓存资源")]),v._v("，接下来我们就从 "),e("code",[v._v("Web")]),v._v(" 应用的需求角度来看看 "),e("code",[v._v("Service Worker")]),v._v(" 的设计思路。")]),v._v(" "),e("p",[e("strong",[v._v("1. 架构")])]),v._v(" "),e("p",[v._v("通过前面页面循环系统的分析，我们已经知道了 "),e("code",[v._v("JavaScript")]),v._v(" 和页面"),e("strong",[v._v("渲染流水线")]),v._v("的任务都是在页面"),e("strong",[v._v("主线程")]),v._v("上执行的，如果一段 "),e("code",[v._v("JavaScript")]),v._v(" 执行时间过久，那么就会"),e("strong",[v._v("阻塞主线程")]),v._v("，使得"),e("strong",[v._v("渲染一帧的时间变长")]),v._v("，从而让用户产生"),e("strong",[v._v("卡顿")]),v._v("的感觉，这对用户来说体验是非常不好的。")]),v._v(" "),e("p",[v._v("为了避免 "),e("code",[v._v("JavaScript")]),v._v(" 过多占用页面主线程时长的情况，浏览器实现了 "),e("code",[v._v("Web Worker")]),v._v(" 的功能。"),e("code",[v._v("Web Worker")]),v._v(" 的目的是让 "),e("code",[v._v("JavaScript")]),v._v(" "),e("strong",[v._v("能够运行在页面主线程之外")]),v._v("，不过由于 "),e("code",[v._v("Web Worker")]),v._v(" 中是没有当前页面的 "),e("code",[v._v("DOM")]),v._v(" 环境的，所以在 "),e("code",[v._v("Web Worker")]),v._v(" 中只能执行一些和 "),e("code",[v._v("DOM")]),v._v(" "),e("strong",[v._v("无关")]),v._v("的 "),e("code",[v._v("JavaScript")]),v._v(" 脚本，并通过 "),e("code",[v._v("postMessage")]),v._v(" 方法将执行的结果"),e("strong",[v._v("返回给主线程")]),v._v("。所以说在 "),e("code",[v._v("Chrome")]),v._v(" 中， "),e("code",[v._v("Web Worker")]),v._v(" 其实就是在"),e("strong",[v._v("渲染进程中")]),v._v("开启的一个"),e("strong",[v._v("新线程")]),v._v("，它的生命周期是和页面关联的。")]),v._v(" "),e("p",[v._v("“"),e("strong",[v._v("让其运行在主线程之外")]),v._v("”就是 "),e("code",[v._v("Service Worker")]),v._v(" 来自 "),e("code",[v._v("Web Worker")]),v._v(" 的一个核心思想。不过 "),e("code",[v._v("Web Worker")]),v._v(" 是"),e("strong",[v._v("临时的")]),v._v("，每次 "),e("code",[v._v("JavaScript")]),v._v(" 脚本执行完成之后都会退出，执行结果也不能保存下来，如果下次还有同样的操作，就还得重新来一遍。所以 "),e("code",[v._v("Service Worker")]),v._v(" 需要在 "),e("code",[v._v("Web Worker")]),v._v(" 的基础之上加上"),e("strong",[v._v("储存功能")]),v._v("。")]),v._v(" "),e("p",[v._v("另外，由于 "),e("code",[v._v("Service Worker")]),v._v(" 还需要会为多个页面提供服务，所以还不能把 "),e("code",[v._v("Service Worker")]),v._v(" 和单个页面绑定起来。在目前的 "),e("code",[v._v("Chrome")]),v._v(" 架构中，"),e("code",[v._v("Service Worker")]),v._v(" 是运行在"),e("strong",[v._v("浏览器进程")]),v._v("中的，因为浏览器进程生命周期是最长的，所以在浏览器的生命周期内，能够为所有的页面提供服务。")]),v._v(" "),e("p",[e("strong",[v._v("2. 消息推送")])]),v._v(" "),e("p",[e("strong",[v._v("消息推送")]),v._v("也是基于 "),e("code",[v._v("Service Worker")]),v._v(" 来实现的。因为消息推送时，浏览器页面也许并没有启动，这时就需要 "),e("code",[v._v("Service Worker")]),v._v(" 来接收服务器推送的消息，并将消息通过一定方式展示给用户。关于消息推送的细节这里我们就不详述了，如果你感兴趣的话可以自行搜索相关资料去学习。")]),v._v(" "),e("p",[e("strong",[v._v("3. 安全")])]),v._v(" "),e("p",[v._v("基于 "),e("code",[v._v("Web")]),v._v(" 应用的业务越来越多了，其安全问题是不可忽视的，所以在设计 "),e("code",[v._v("Service Worker")]),v._v(" 之初，安全问题就被提上了日程。")]),v._v(" "),e("p",[v._v("关于安全，其中最为核心的一条就是 "),e("code",[v._v("HTTP")]),v._v("。我们知道，"),e("code",[v._v("HTTP")]),v._v(" 采用的是"),e("strong",[v._v("明文传输")]),v._v("信息，存在被窃听、被篡改和被劫持的风险，在项目中使用 "),e("code",[v._v("HTTP")]),v._v(" 来传输数据无疑是“裸奔”。所以在设计之初，就考虑对 "),e("code",[v._v("Service Worker")]),v._v(" 采用 "),e("code",[v._v("HTTPS")]),v._v(" 协议，因为采用 "),e("code",[v._v("HTTPS")]),v._v(" 的通信数据都是经过加密的，即便拦截了数据，也无法破解数据内容，而且 "),e("code",[v._v("HTTPS")]),v._v(" 还有校验机制，通信双方很容易知道数据是否被篡改。关于 "),e("code",[v._v("HTTPS")]),v._v(" 协议，我们会在最后的安全模块详细介绍。")]),v._v(" "),e("p",[v._v("所以要使站点支持 "),e("code",[v._v("Service Worker")]),v._v("，首先必要的一步就是要将站点升级到 "),e("code",[v._v("HTTPS")]),v._v("。")]),v._v(" "),e("p",[v._v("除了必须要使用 "),e("code",[v._v("HTTPS")]),v._v("，"),e("code",[v._v("Service Worker")]),v._v(" 还需要同时支持 "),e("code",[v._v("Web")]),v._v(" 页面默认的"),e("strong",[v._v("安全策略")]),v._v("、"),e("strong",[v._v("储入同源策略")]),v._v("、"),e("strong",[v._v("内容安全策略")]),v._v("（"),e("code",[v._v("CSP")]),v._v("）等，关于这些，后续我们也会详细介绍。")]),v._v(" "),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[v._v("#")]),v._v(" 总结")]),v._v(" "),e("p",[v._v("好了，今天就介绍到这里，下面我来总结下本文的主要内容。")]),v._v(" "),e("p",[v._v("我们先分析了"),e("code",[v._v("PWA")]),v._v("，它是由"),e("strong",[v._v("很多技术组成的一个理念")]),v._v("，其核心思想是"),e("strong",[v._v("渐进式")]),v._v("。对于开发者，它提供了非常温和的方式，让开发者将普通的站点逐步过渡到 "),e("code",[v._v("Web")]),v._v(" 应用。对于技术本身而言，它是"),e("strong",[v._v("渐进式演进")]),v._v("，逐渐将 "),e("code",[v._v("Web")]),v._v(" 技术发挥到极致的同时，也"),e("strong",[v._v("逐渐缩小")]),v._v("和本地应用的差距。在此基础上，我们又分析了 "),e("code",[v._v("PWA")]),v._v(" 中的 "),e("code",[v._v("Service Worker")]),v._v(" 的设计思路。")]),v._v(" "),e("p",[v._v("另外，"),e("code",[v._v("PWA")]),v._v(" 还提供了 "),e("code",[v._v("manifest.json")]),v._v("配置文件，可以让开发者"),e("strong",[v._v("自定义桌面的图标")]),v._v("、"),e("strong",[v._v("显示名称")]),v._v("、"),e("strong",[v._v("启动方式")]),v._v("等信息，还可以设置启动画面、页面主题颜色等信息。关于 "),e("code",[v._v("manifest.json")]),v._v(" 的配置还是比较简单的，详细使用教程网上有很多，这里我就不做介绍了。")]),v._v(" "),e("p",[e("strong",[v._v("添加桌面标")]),v._v("、"),e("strong",[v._v("增加离线缓存")]),v._v("、"),e("strong",[v._v("增加消息推送")]),v._v("等功能是 "),e("code",[v._v("PWA")]),v._v(" 走向设备的必备功能，但我认为真正决定 "),e("code",[v._v("PWA")]),v._v(" 能否崛起的还是底层技术，比如"),e("strong",[v._v("页面渲染效率")]),v._v("、"),e("strong",[v._v("对系统设备的支持程度")]),v._v("、"),e("code",[v._v("WebAssembly")]),v._v(" 等，而这些技术也在渐进式进化过程中。所以未来如何，我们拭目以待")])])}),[],!1,null,null,null);_.default=r.exports}}]);