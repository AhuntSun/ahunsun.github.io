(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{521:function(t,e,v){"use strict";v.r(e);var _=v(27),o=Object(_.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"_04-移动端300ms延迟"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_04-移动端300ms延迟"}},[t._v("#")]),t._v(" 04.移动端300ms延迟")]),t._v(" "),v("h2",{attrs:{id:"_1-300ms延迟的产生缘由"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-300ms延迟的产生缘由"}},[t._v("#")]),t._v(" 1. 300ms延迟的产生缘由")]),t._v(" "),v("p",[t._v("移动端浏览器的默认显示宽度是"),v("code",[t._v("980px")]),t._v("(不同机型各异，但相差不大)，而不是屏幕的宽度("),v("code",[t._v("320px")]),t._v("或其他)。为了对早期普通网页更好的体验，"),v("code",[t._v("iphone")]),t._v("设计了双击放大显示的功能--这就是"),v("code",[t._v("300ms")]),t._v("延迟的来源：如果用户一次点击后"),v("code",[t._v("300ms")]),t._v("内没有其他操作，则认为是个单击行为；否则为双击放大行为。")]),t._v(" "),v("h2",{attrs:{id:"_2-点透行为"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-点透行为"}},[t._v("#")]),t._v(" 2. 点透行为")]),t._v(" "),v("p",[t._v("假设有两个层级，"),v("code",[t._v("A")]),t._v("和"),v("code",[t._v("B")]),t._v("；"),v("code",[t._v("A")]),t._v("在上面，"),v("code",[t._v("B")]),t._v("在下面。 如果"),v("code",[t._v("A")]),t._v("监听"),v("code",[t._v("touch")]),t._v("事件("),v("code",[t._v("zepto")]),t._v("的"),v("code",[t._v("tap")]),t._v("事件)，而且"),v("code",[t._v("B")]),t._v("上有个链接(或者监听"),v("code",[t._v("click")]),t._v("事件)，那么当"),v("code",[t._v("touch A")]),t._v("后，先后触发了"),v("code",[t._v("touchStart")]),t._v("和"),v("code",[t._v("touchEnd")]),t._v("事件，"),v("code",[t._v("touchEnd")]),t._v("后"),v("code",[t._v("A")]),t._v("层隐藏，而此刻会触发在"),v("code",[t._v("document")]),t._v("最前面"),v("code",[t._v("B")]),t._v("的"),v("code",[t._v("click")]),t._v("事件；这就是点透行为。")]),t._v(" "),v("h2",{attrs:{id:"_3-解决方法"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-解决方法"}},[t._v("#")]),t._v(" 3. 解决方法")]),t._v(" "),v("ol",[v("li",[t._v("设置不能缩放："),v("code",[t._v("user-scalable=no")]),t._v("。 不能缩放就不会有双击缩放操作，因此"),v("code",[t._v("click")]),t._v("事件也就没了"),v("code",[t._v("300ms")]),t._v("延迟，这个是"),v("code",[t._v("Chrome")]),t._v("首先在"),v("code",[t._v("Android")]),t._v("中提出的。")]),t._v(" "),v("li",[t._v("设置显示宽度："),v("code",[t._v("width=device-width")]),t._v("。"),v("code",[t._v("Chrome")]),t._v(" 开发团队"),v("a",{attrs:{href:"https://link.jianshu.com/?t=https://groups.google.com/a/chromium.org/forum/#!topic/chromium-dev/8evES7o-QTY",target:"_blank",rel:"noopener noreferrer"}},[t._v("不久前宣布"),v("OutboundLink")],1),t._v("，在 "),v("code",[t._v("Chrome 32")]),t._v(" 这一版中，他们将"),v("a",{attrs:{href:"https://link.jianshu.com/?t=https://codereview.chromium.org/18850005/",target:"_blank",rel:"noopener noreferrer"}},[t._v("在包含 width=device-width 或者置为比 viewport 值更小的页面上禁用双击缩放"),v("OutboundLink")],1),t._v("。当然，没有双击缩放就没有 "),v("code",[t._v("300")]),t._v(" 毫秒点击延迟。")]),t._v(" "),v("li",[v("code",[t._v("IE")]),t._v("的指针事件 ("),v("code",[t._v("Pointer Events")]),t._v(")：设置"),v("code",[t._v("touch-action:none")]),t._v("，根据"),v("a",{attrs:{href:"https://link.jianshu.com/?t=https://dvcs.w3.org/hg/pointerevents/raw-file/tip/pointerEvents.html#the-touch-action-css-property",target:"_blank",rel:"noopener noreferrer"}},[t._v("规范"),v("OutboundLink")],1),t._v("，"),v("code",[t._v("touch-action")]),t._v(" 属性决定 "),v("em",[t._v("“是否触摸操作会触发用户代理的默认行为。这包括但不限于双指缩放等行为”")]),t._v("。\n从实际应用的角度来看，"),v("code",[t._v("touch-action")]),t._v("决定了用户在点击了目标元素之后，是否能够进行双指缩放或者双击缩放。因此，这也相当完美地解决了 "),v("code",[t._v("300")]),t._v(" 毫秒点击延迟的问题。")])]),t._v(" "),v("p",[t._v("鉴于上述的"),v("code",[t._v("3")]),t._v("种解决方案，现在较为通用的"),v("code",[t._v("meta")]),t._v("设置为：")]),t._v(" "),v("div",{staticClass:"language-html line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-html"}},[v("code",[v("span",{pre:!0,attrs:{class:"token tag"}},[v("span",{pre:!0,attrs:{class:"token tag"}},[v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br")])]),v("h2",{attrs:{id:"_4-现在的流行解决方案："}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-现在的流行解决方案："}},[t._v("#")]),t._v(" 4. 现在的流行解决方案：")]),t._v(" "),v("p",[t._v("上述的"),v("code",[t._v("3")]),t._v("种解决方案可以解决"),v("code",[t._v("Chrome Android")]),t._v("和"),v("code",[t._v("IE10+")]),t._v("下的"),v("code",[t._v("300ms")]),t._v("问题，但是对"),v("strong",[t._v("其他浏览器")]),t._v("还需要特定的解决方案。")]),t._v(" "),v("ol",[v("li",[t._v("指针事件的 "),v("code",[t._v("polyfill")]),t._v("\n指针事件的 "),v("code",[t._v("polyfill")]),t._v(" 比较多，以下列出比较流行的几个。"),v("code",[t._v("Google")]),t._v(" 的 "),v("a",{attrs:{href:"https://link.jianshu.com/?t=https://github.com/Polymer/PointerEvents",target:"_blank",rel:"noopener noreferrer"}},[t._v("Polymer"),v("OutboundLink")],1),t._v("，微软的 "),v("a",{attrs:{href:"https://link.jianshu.com/?t=http://handjs.codeplex.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("HandJS"),v("OutboundLink")],1),t._v("和"),v("a",{attrs:{href:"https://link.jianshu.com/?t=https://github.com/Rich-Harris",target:"_blank",rel:"noopener noreferrer"}},[t._v("@Rich-Harris"),v("OutboundLink")],1),t._v(" 的 "),v("a",{attrs:{href:"https://link.jianshu.com/?t=https://github.com/Rich-Harris/Points",target:"_blank",rel:"noopener noreferrer"}},[t._v("Points"),v("OutboundLink")],1)]),t._v(" "),v("li",[v("strong",[t._v("FastClick")]),t._v(" "),v("a",{attrs:{href:"https://link.jianshu.com/?t=https://github.com/ftlabs/fastclick",target:"_blank",rel:"noopener noreferrer"}},[t._v("FastClick"),v("OutboundLink")],1),t._v(" 是 "),v("a",{attrs:{href:"https://link.jianshu.com/?t=http://labs.ft.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("FT Labs"),v("OutboundLink")],1),t._v(" 专门为解决移动端浏览器 "),v("code",[t._v("300")]),t._v(" 毫秒点击延迟问题所开发的一个轻量级的库。简而言之，"),v("code",[t._v("FastClick")]),t._v(" 在检测到 "),v("code",[t._v("touchend")]),t._v("事件的时候，会通过 "),v("a",{attrs:{href:"https://link.jianshu.com/?t=https://developer.mozilla.org/zh-CN/docs/Web/API/Event/createEvent",target:"_blank",rel:"noopener noreferrer"}},[t._v("DOM 自定义事件"),v("OutboundLink")],1),t._v("立即触发一个模拟"),v("code",[t._v("click")]),t._v("事件，并把浏览器在 "),v("code",[t._v("300")]),t._v(" 毫秒之后真正触发的 "),v("code",[t._v("click")]),t._v("事件阻止掉。")])]),t._v(" "),v("h2",{attrs:{id:"_5-fastclick"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-fastclick"}},[t._v("#")]),t._v(" 5. FastClick")]),t._v(" "),v("p",[t._v("现阶段"),v("code",[t._v("FastClick")]),t._v("被更多使用，借助它通过监听"),v("code",[t._v("click")]),t._v("事件，即可消除"),v("code",[t._v("300ms")]),t._v("的问题。\n通过阅读源码可知：")]),t._v(" "),v("ol",[v("li",[v("code",[t._v("FastClick")]),t._v("通过"),v("strong",[t._v("判断浏览器类型")]),t._v("决定其是不是需要执行，下面几种场景下不会执行"),v("code",[t._v("FastClick")]),t._v("逻辑：")])]),t._v(" "),v("ul",[v("li",[t._v("不支持"),v("code",[t._v("ontouchstart")]),t._v("事件的浏览器")]),t._v(" "),v("li",[v("code",[t._v("Android Chrome")]),t._v(" 或者 "),v("code",[t._v("firefox27")]),t._v("以上 设置了"),v("code",[t._v('user-scalable="no"')])]),t._v(" "),v("li",[t._v("满足特定要求的 "),v("code",[t._v("IE10+")]),t._v(" 浏览器")]),t._v(" "),v("li",[t._v("部分黑莓浏览器")])]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[t._v("注册了"),v("code",[t._v("touchStart")]),t._v("、"),v("code",[t._v("touchEnd")]),t._v("等事件，监听"),v("code",[t._v("touchStart")]),t._v("决定事件对象的"),v("code",[t._v("target")]),t._v("、时间、位置等信息；通过"),v("code",[t._v("touchEnd")]),t._v("得到"),v("code",[t._v("touch")]),t._v("的结束时间。如果"),v("code",[t._v("touch")]),t._v("时长大于"),v("code",[t._v("700ms")]),t._v("，则是长按事件；如果连续两次"),v("code",[t._v("touchEnd")]),t._v("的时间间隔小于"),v("code",[t._v("200ms")]),t._v("，那么认定为快速点击，特殊对待；排除上面两种情况，就通过"),v("code",[t._v("clickEvent = document.createEvent('MouseEvents'); initMouseEvent; dispatchEvent")]),t._v("手动触发"),v("code",[t._v("click")]),t._v("事件。")])])])}),[],!1,null,null,null);e.default=o.exports}}]);